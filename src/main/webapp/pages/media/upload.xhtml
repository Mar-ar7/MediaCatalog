<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui">
<h:head>
    <title>Gestión de Archivos Multimedia</title>
</h:head>
<h:body>

    <h:form enctype="multipart/form-data">
        <p:growl showDetail="true" />

        <p:panel header="Archivos de #{mediaFileBean.selectedTitle.titleName}" style="width:700px">

            <!-- Subida -->
            <p:fileUpload mode="advanced"
                          dragDropSupport="true"
                          multiple="true"
                          auto="true"
                          sizeLimit="5242880"
                          allowTypes="/(\.|\/)(pdf|jpg|jpeg|png)$/"
                          update="@form"
                          listener="#{mediaFileBean.handleFileUpload}" />

            <!-- Tabla de archivos -->
            <p:dataTable value="#{mediaFileBean.files}" var="f" style="margin-top:20px" emptyMessage="Sin archivos aún">
                <p:column headerText="Tipo">
                    <h:outputText value="#{f.fileType}" />
                </p:column>
                <p:column headerText="Archivo">
                    <h:outputLink value="#{f.blobUrl}" target="_blank">
                        <h:outputText value="#{f.blobUrl}" />
                    </h:outputLink>
                </p:column>
                <p:column headerText="Tamaño (KB)">
                    <h:outputText value="#{f.sizeBytes / 1024}" />
                </p:column>
                <p:column headerText="Fecha">
                    <h:outputText value="#{f.uploadedAt}">
                        <f:convertDateTime pattern="dd/MM/yyyy HH:mm" />
                    </h:outputText>
                </p:column>
                <p:column headerText="Acciones" style="width:100px">
                    <p:commandButton icon="pi pi-trash"
                                     title="Eliminar"
                                     update="@form"
                                     actionListener="#{mediaFileBean.delete(f)}"
                                     styleClass="ui-button-danger ui-button-flat" />
                </p:column>
            </p:dataTable>

            <!-- Regresar -->
            <p:commandButton value="Volver"
                             icon="pi pi-arrow-left"
                             outcome="/pages/media/list.xhtml"
                             ajax="false"
                             style="margin-top:20px" />

        </p:panel>
    </h:form>

</h:body>
</html>
